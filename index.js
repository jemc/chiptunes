(()=>{var e={480:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutoMap=void 0;class AutoMap extends Map{constructor(e){super(),this.vClass=e}getOrCreate(e){const t=this.get(e);if(t)return t;const s=new this.vClass;return this.set(e,s),s}}t.AutoMap=AutoMap},376:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitMask=void 0;const i=s(872);t.BitMask=class BitMask{constructor(e=16){const t=Math.ceil(e/16);this.data=new Uint16Array(t)}clear(){this.data.fill(0)}set(e,t){const s=e>>4,r=1<<e%16;if(this.data.length<=s){const e=(0,i.roundUpToPowerOfTwo)(s+1),t=new Uint16Array(e).fill(0);t.set(this.data),this.data=t}return t?this.data[s]|=r:this.data[s]&=~r,!0}isSuperSetOf(e){for(var t,s,i=0;i<this.data.length;i++){const r=null!==(t=this.data[i])&&void 0!==t?t:0,o=null!==(s=e.data[i])&&void 0!==s?s:0;if((o&r)!==o)return!1}return!0}}},764:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MutableBox2=t.Box2=void 0;const i=s(724);class BaseBox2{constructor(e,t){this.center=e,this.radii=t}isEqualTo(e){return this.center.isEqualTo(e.center)&&this.radii.isEqualTo(e.radii)}doesContain(e){return!(Math.abs(e.x-this.center.x)>this.radii.x)&&!(Math.abs(e.y-this.center.y)>this.radii.y)}get x(){return this.center.x}get y(){return this.center.y}get x0(){return this.center.x-this.radii.x}get y0(){return this.center.y-this.radii.y}get x1(){return this.center.x+this.radii.x}get y1(){return this.center.y+this.radii.y}get width(){return this.radii.x+this.radii.x}get height(){return this.radii.y+this.radii.y}}class Box2 extends BaseBox2{constructor(e=new i.Vector2,t=new i.Vector2){super(e,t),this.center=e,this.radii=t}static fromLeftTopWidthHeight(e,t,s,r){const o=new i.Vector2(s/2,r/2);return new Box2(new i.Vector2(e+o.x,t+o.y),o)}__preventTypeConfusion(){return"immutable"}}t.Box2=Box2;t.MutableBox2=class MutableBox2 extends BaseBox2{constructor(e=new i.MutableVector2,t=new i.MutableVector2){super(e,t),this.center=e,this.radii=t}__preventTypeConfusion(){return"mutable"}copyFrom(e){return this.center.copyFrom(e.center),this.radii.copyFrom(e.radii),this}}},816:(e,t,s)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonSourceSystem=t.ButtonSourceConfig=t.ButtonSource=t.ButtonState=t.Button=void 0;const r=s(100);var o;!function(e){e[e.Start=0]="Start",e[e.Select=1]="Select",e[e.Up=2]="Up",e[e.Down=3]="Down",e[e.Left=4]="Left",e[e.Right=5]="Right",e[e.A=6]="A",e[e.B=7]="B",e[e.X=8]="X",e[e.Y=9]="Y"}(o||(t.Button=o={}));t.ButtonState=class ButtonState{constructor(e){this.clock=e,this.pressedAt=new Array}capture(e){void 0===this.pressedAt[e]&&(this.pressedAt[e]=this.clock.frame+1)}release(e){delete this.pressedAt[e]}isPressed(e){return void 0!==this.pressedAt[e]}isPressedJustNow(e){return this.pressedAt[e]===this.clock.frame}};class ButtonSource{constructor(e,t){this.state=e,this.config=t}captureKeyboardEvent(e){const t=this.config.keyboard[e.code];return!!t&&void 0!==t.find((t=>{if(!t.ignoreModifiers){if(e.altKey!=!!t.alt)return!1;if(e.ctrlKey!=!!t.ctrl)return!1;if(e.shiftKey!=!!t.shift)return!1}return this.state.capture(t.button),!0}))}releaseKeyboardEvent(e){const t=this.config.keyboard[e.code];if(!t)return;let s=!1;for(const e of t)this.state.isPressed(e.button)&&(this.state.release(e.button),s=!0);return s}}t.ButtonSource=ButtonSource,i=ButtonSource,ButtonSource.componentId=(0,r.registerComponent)(i),t.ButtonSourceConfig={Default:{keyboard:{Enter:[{button:o.Start}],RightShift:[{button:o.Select}],ArrowUp:[{button:o.Up}],ArrowDown:[{button:o.Down}],ArrowLeft:[{button:o.Left}],ArrowRight:[{button:o.Right}],KeyW:[{button:o.Up}],KeyA:[{button:o.Left}],KeyS:[{button:o.Down}],KeyD:[{button:o.Right}],KeyZ:[{button:o.A}],KeyX:[{button:o.B}],KeyC:[{button:o.X}],KeyV:[{button:o.Y}],ControlRight:[{button:o.A}],AltRight:[{button:o.B}]}}},t.ButtonSourceSystem=function(e,t){const s=new Map;return t.addEventListener("keydown",(e=>{const t=e;for(const i of s.values())i.captureKeyboardEvent(t)&&e.preventDefault()})),t.addEventListener("keyup",(e=>{const t=e;for(const i of s.values())i.releaseKeyboardEvent(t)&&e.preventDefault()})),e.systemFor([ButtonSource],{runEachSet(e,t){s.set(e,t)},runEachRemoved(e){s.delete(e)}})}},185:(e,t,s)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ChildOf=void 0;const r=s(100);class ChildOf{constructor(e){this.parent=e}}t.ChildOf=ChildOf,i=ChildOf,ChildOf.componentId=(0,r.registerComponent)(i)},676:(e,t,s)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Clock=void 0;const r=null===(i=s.g.window)||void 0===i?void 0:i.requestAnimationFrame;t.Clock=class Clock{constructor(e=(()=>{}),t=(null!=r?r:void 0)){this.runFn=e,this.requestNextFrame=t,this.frame=0,this.timestamp=0,this.currentFramesPerSecond=0,this.alreadyStarted=!1,this.tickAndKeepRunningFn=this.tickAndKeepRunning.bind(this)}startRunning(){this.alreadyStarted||(this.requestNextFrame&&this.requestNextFrame(this.tickAndKeepRunningFn),this.alreadyStarted=!0)}tickAndKeepRunning(e){this.tick(e),r(this.tickAndKeepRunningFn)}tick(e){const t=1e3/(e-this.timestamp);if(this.slowMotionFactor&&this.slowMotionFactor>60/t)return;const s=this;s.frame++,s.timestamp=e,s.currentFramesPerSecond=t,this.runFn()}}},100:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newEntityPoolWithStaticComponentsReserved=t.getComponentClassById=t.registerComponent=void 0;const i=s(216),r=new i.EntityPool,o=[];t.registerComponent=function(e){if(Object.isFrozen(r))throw new Error("A component can only be registered statically before any world is created. After that they can only be registered dynamically with an individual world (which is not yet supported).");const t=r.alloc();return o[t]=e,t},t.getComponentClassById=function(e){return o[e]},t.newEntityPoolWithStaticComponentsReserved=function(){return Object.freeze(r),new i.EntityPool(r)}},704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},216:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityPool=void 0;t.EntityPool=class EntityPool{constructor(e){this.bitPool=new Uint8Array(1024).fill(255),this.firstNonZeroByteIndex=0,e&&(this.bitPool=new Uint8Array(e.bitPool.length).fill(255),this.bitPool.set(e.bitPool),this.firstNonZeroByteIndex=e.firstNonZeroByteIndex)}get capacity(){return 8*this.bitPool.length}alloc(){const e=this.firstNonZeroByteIndex;var t=this.bitPool[e];const s=Math.log2(t&-t);if(t&=~(1<<s),this.bitPool[e]=t,0==t&&(this.firstNonZeroByteIndex++,this.firstNonZeroByteIndex>=this.bitPool.length)){const e=new Uint8Array(2*this.bitPool.length).fill(255);e.set(this.bitPool),this.bitPool=e}return(e<<3)+s}free(e){const t=e>>3,s=7&e;this.bitPool[t]|=1<<s,t<this.firstNonZeroByteIndex&&(this.firstNonZeroByteIndex=t)}}},248:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadAsset=void 0;t.LoadAsset=class LoadAsset{constructor(e){this.url=e,setTimeout((()=>this.load()))}get result(){return this._result}get isFinished(){return void 0!==this._result}finished(e){this.isFinished||(this._result=e)}}},351:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBlobAsset=void 0;const i=s(248);class LoadBlobAsset extends i.LoadAsset{load(){const e=this,t=new XMLHttpRequest;t.responseType="blob",t.onload=()=>e.finished(t.response),t.open("GET",e.url+"?cb="+Date.now(),!0),t.send()}}t.LoadBlobAsset=LoadBlobAsset},528:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadImageAsset=void 0;const i=s(248);class LoadImageAsset extends i.LoadAsset{load(){const e=this,t=new Image;t.onload=()=>e.finished(t),t.crossOrigin="anonymous",t.src=e.url+"?cb="+Date.now()}}t.LoadImageAsset=LoadImageAsset},872:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPowerOfTwo=t.roundUpToPowerOfTwo=t.toDegrees=t.toRadians=void 0;const s=Math.PI/180;t.toRadians=function(e){return e*s};const i=180/Math.PI;t.toDegrees=function(e){return e*i},t.roundUpToPowerOfTwo=function(e){const t=e<0?-1:1;return e*=t,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e|=e>>32,(e+=1)*t},t.isPowerOfTwo=function(e){return 0==(e&e-1)}},116:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix3=void 0;const i=s(724);t.Matrix3=class Matrix3{static create(){return this.setToIdentity(new Float32Array(9))}static setToIdentity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}static setTransformRows(e,t,s,i,r){e[0]=i*s.x,e[1]=-r*s.y,e[2]=Math.floor(t.x),e[3]=r*s.x,e[4]=i*s.y,e[5]=Math.floor(t.y)}static multiply(e,t,s){{const i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],c=e[5],u=e[6],l=e[7],d=e[8],h=t[0],f=t[1],m=t[2],p=t[3],v=t[4],y=t[5],b=t[6],g=t[7],w=t[8];s[0]=h*i+f*n+m*u,s[1]=h*r+f*a+m*l,s[2]=h*o+f*c+m*d,s[3]=p*i+v*n+y*u,s[4]=p*r+v*a+y*l,s[5]=p*o+v*c+y*d,s[6]=b*i+g*n+w*u,s[7]=b*r+g*a+w*l,s[8]=b*o+g*c+w*d}return s}static applyToVector2(e,t){return new i.Vector2(t.x*e[0]+t.y*e[1]+e[2],t.x*e[3]+t.y*e[4]+e[5])}}},260:(e,t,s)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.StatusSystem=t.Status=void 0;const r=s(100);class Status{constructor(e,t){var s,i;this.clock=e,this.configs={},this.map={},this.configs=t;for(const[e,i]of Object.entries(t))if(i.blocks)for(const t of i.blocks){const i=this.configs[t];i&&(i.blockedBy=null!==(s=i.blockedBy)&&void 0!==s?s:[],i.blockedBy.push(e))}for(const[e,s]of Object.entries(t))if(s.sustains)for(const t of s.sustains){const s=this.configs[t];s&&(s.sustainedBy=null!==(i=s.sustainedBy)&&void 0!==i?i:[],s.sustainedBy.push(e))}for(const[e,s]of Object.entries(t))s.setAtStart&&this.set(e)}get list(){return Object.keys(this.map)}is(e){return void 0!==this.map[e]}isStarting(e){return this.map[e]===this.clock.frame}stop(e){if(void 0===this.map[e])return;const t=this.configs[e];if(null==t?void 0:t.sustainedBy)for(const e of t.sustainedBy)if(this.is(e))return;delete this.map[e],(null==t?void 0:t.then)&&t.then.forEach((e=>this.set(e)))}set(e,t=!0){if(!t)return void this.stop(e);if(void 0!==this.map[e])return;const s=this.configs[e];if(null==s?void 0:s.blockedBy)for(const e of s.blockedBy)if(this.is(e))return;this.map[e]=this.clock.frame,(null==s?void 0:s.sets)&&s.sets.forEach((e=>this.set(e))),(null==s?void 0:s.stops)&&s.stops.forEach((e=>this.stop(e)))}setMany(e){for(const[t,s]of Object.entries(e))this.set(t,s)}each(e){for(const[t,s]of Object.entries(this.map)){const i=this.configs[t];i&&e(t,i,s)}}noticeTime(){for(const[e,t]of Object.entries(this.map)){const s=this.configs[e];(null==s?void 0:s.maxFrames)&&(null==s?void 0:s.maxFrames)<this.clock.frame-t&&this.stop(e)}}}t.Status=Status,i=Status,Status.componentId=(0,r.registerComponent)(i);t.StatusSystem=e=>e.systemFor([Status],{runEach(e,t){t.noticeTime()}})},605:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.System=void 0;const i=s(376);t.System=class System{constructor(e){this.componentTypes=e,this._requiredBits=new i.BitMask,this._entities=new Map}setEntityComponents(e,t){const s=this._entities.size;this._entities.set(e,t),s!==this._entities.size?this.runEachAdded(e,...t):this.runEachModified(e,...t),this.runEachSet(e,...t)}removeEntityIfPresent(e){const t=this._entities.size;this._entities.delete(e),t!==this._entities.size&&this.runEachRemoved(e)}run(e){for(const[t,s]of e.entries())this.runEach(t,...s)}runEach(e,...t){}runEachAdded(e,...t){}runEachModified(e,...t){}runEachSet(e,...t){}runEachRemoved(e){}}},748:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Uint32Array2D=void 0;const i=s(724);class Uint32Array2D{get width(){return this.size.x}get height(){return this.size.y}constructor(e,t=new i.Vector2(0,0)){this.size=e,this.offset=t,this.buffer=new ArrayBuffer(this.width*this.height*4),this.rawBytes=new Uint8Array(this.buffer),this.rawUint32s=new Uint32Array(this.buffer)}static fromArrayLiterals(e,t=new i.Vector2(0,0)){var s,r;const o=new i.Vector2(null!==(r=null===(s=e[0])||void 0===s?void 0:s.length)&&void 0!==r?r:0,e.length),n=new Uint32Array2D(o,t);return n.rawUint32s.set(e.flat()),n}get(e,t){var s;return e-=this.offset.x,t-=this.offset.y,e<0||t<0||e>=this.width||t>=this.height?0:null!==(s=this.rawUint32s[e+t*this.width])&&void 0!==s?s:0}set(e,t,s){if(e-=this.offset.x,t-=this.offset.y,e<0||t<0||e>=this.width||t>=this.height)throw new Error(`set element out of bounds: (${e}, ${t}) within ${this.size.x} x ${this.size.y} size with offset (${this.offset.x}, ${this.offset.y})`);this.rawUint32s[e+t*this.width]=s}forEach(e){for(var t=0;t<this.rawUint32s.length;t++){const s=t%this.width,i=Math.floor(t/this.width);e(this.rawUint32s[t],s+this.offset.x,i+this.offset.y)}}cloneWithoutOffset(){const e=new Uint32Array2D(this.size.plus(this.offset));return e.rawUint32s.fill(0),this.forEach(((t,s,i)=>{e.rawUint32s[s+i*e.width]=t})),e}}t.Uint32Array2D=Uint32Array2D},724:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MutableVector2=t.Vector2=void 0;const i=s(872);class BaseVector2{constructor(e=0,t=0){this.x=e,this.y=t}isEqualTo(e){return this.x===e.x&&this.y===e.y}clone(){return new Vector2(this.x,this.y)}cloneMutable(){return new MutableVector2(this.x,this.y)}magnitude(){return Math.sqrt(this.magnitudeSquared())}magnitudeSquared(){return this.x*this.x+this.y*this.y}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}plus(e){return new Vector2(this.x+e.x,this.y+e.y)}minus(e){return new Vector2(this.x-e.x,this.y-e.y)}scale(e){return new Vector2(this.x*e,this.y*e)}}class Vector2 extends BaseVector2{__preventTypeConfusion(){return"immutable"}}t.Vector2=Vector2;class MutableVector2 extends BaseVector2{constructor(e=0,t=0){super(e,t),this.x=e,this.y=t}__preventTypeConfusion(){return"mutable"}setTo(e,t){return this.x=e,this.y=t,this}copyFrom(e){return this.x=e.x,this.y=e.y,this}setUnitRotationRadians(e){return this.x=Math.cos(e),this.y=Math.sin(e),this}setUnitRotationDegrees(e){return this.setUnitRotationRadians((0,i.toRadians)(e)),this}toFloor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}toRoundedCapturingResiduals(e){const{x:t,y:s}=this;return this.x=Math.round(t),this.y=Math.round(s),e.x=t-this.x,e.y=s-this.y,this}plusEquals(e){return this.x+=e.x,this.y+=e.y,this}plusScalarEquals(e){return this.x+=e,this.y+=e,this}minusEquals(e){return this.x-=e.x,this.y-=e.y,this}minusScalarEquals(e){return this.x-=e,this.y-=e,this}multiplyEquals(e){return this.x*=e.x,this.y*=e.y,this}scaleEquals(e){return this.x*=e,this.y*=e,this}inverseScaleEquals(e){return this.x/=e,this.y/=e,this}plusScaledEquals(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}}t.MutableVector2=MutableVector2},776:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.World=void 0;const i=s(100),r=s(605),o=s(676),n=s(376),a=Array;t.World=class World{constructor(){this.storage=[],this.entityBitMasks=[],this.entityPool=(0,i.newEntityPoolWithStaticComponentsReserved)(),this.systems=[],this.clock=new o.Clock((()=>this.run()))}startRunning(){this.clock.startRunning()}systemFor(e,t){return Object.assign(new r.System(e),t)}create(e){const t=this.entityPool.alloc();return e&&this.set(t,e),t}debugInfoFor(e){const t={};return this.storage.forEach(((s,r)=>{var o,n;const a=null==s?void 0:s[e];if(!a)return;const c=null!==(n=null===(o=(0,i.getComponentClassById)(r))||void 0===o?void 0:o.name)&&void 0!==n?n:`${r}`;t[c]=a})),t}destroy(e){var t;this.systems.forEach((t=>t.removeEntityIfPresent(e))),null===(t=this.entityBitMasks[e])||void 0===t||t.clear(),this.storage.forEach((t=>t?t[e]=void 0:void 0)),this.entityPool.free(e)}get(e,t){var s;return null===(s=this.storage[t.componentId])||void 0===s?void 0:s[e]}set(e,t){var s,i,r,o;const c=null!==(s=(r=this.entityBitMasks)[e])&&void 0!==s?s:r[e]=new n.BitMask(62);for(const s of t){const{componentId:t}=s.constructor;c.set(t,!0);(null!==(i=(o=this.storage)[t])&&void 0!==i?i:o[t]=new a)[e]=s}this.updateSystemsForEntity(e,c)}remove(e,t){const s=this.entityBitMasks[e];if(s){for(const i of t){const{componentId:t}=i;s.set(t,!1);const r=this.storage[t];r&&(r[e]=void 0)}this.updateSystemsForEntity(e,s)}}addSystem(e){this.systems.push(e),e.componentTypes.forEach((({componentId:t})=>{e._requiredBits.set(t,!0)})),this.entityBitMasks.forEach(((t,s)=>{this.updateSystemForEntity(e,s,t)}))}addSystems(e=[]){for(const t of e)this.addSystem(t)}run(){for(const e of this.systems)e.run(e._entities)}updateSystemsForEntity(e,t){for(const s of this.systems)this.updateSystemForEntity(s,e,t)}updateSystemForEntity(e,t,s){s.isSuperSetOf(e._requiredBits)?e.setEntityComponents(t,e.componentTypes.map((e=>this.get(t,e)))):e.removeEntityIfPresent(t)}}},956:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,r)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||i(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),r(s(480),t),r(s(764),t),r(s(816),t),r(s(185),t),r(s(676),t),r(s(100),t),r(s(704),t),r(s(248),t),r(s(351),t),r(s(528),t),r(s(872),t),r(s(116),t),r(s(260),t),r(s(605),t),r(s(748),t),r(s(724),t),r(s(776),t)},184:(e,t,s)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ArrangementPlaySystem=t.ArrangementPlay=void 0;const r=s(972),o=s(956),n=s(264),a=s(92);class ArrangementPlay{constructor(e){this.config=e,this.startTimestamp=0,this.voices={},this.pendingNotes={},this.scheduledSections=0,this.scheduleFinishTime=0}setupVoicesIfNeeded(e){var t,s,i,o;for(const[n,a]of Object.entries(this.config.voices))null!==(t=(i=this.voices)[n])&&void 0!==t||(i[n]=new r.Voice(e,a)),null!==(s=(o=this.pendingNotes)[n])&&void 0!==s||(o[n]=[])}scheduleSectionsIfNeeded(e){var t;if(e<=this.scheduleFinishTime)return;const{pre:s,loop:i}=this.config,r=null!==(t=null==s?void 0:s.length)&&void 0!==t?t:0;if(s&&this.scheduledSections<r)this.scheduleSection(s[this.scheduledSections],this.scheduleFinishTime),this.scheduledSections++;else if(i){let e=this.scheduledSections-r;for(;e>=i.length;)e-=i.length;this.scheduleSection(i[e],this.scheduleFinishTime),this.scheduledSections++}}scheduleSection(e,t=0){const s=this.config.sections[e];if(!s)throw new Error(`No section named ${e}`);let i=0;for(const[e,r]of Object.entries(s)){if(!this.voices[e])throw new Error(`No voice named ${e}`);let s=t;for(const t of r)(0,a.riffSeqToVoiceNotes)(t).forEach((([t,i])=>{this.pendingNotes[e].push([t+s,i])})),s+=(0,a.riffDuration)(t);s>i&&(i=s)}this.scheduleFinishTime=i}continuePlaying(e,t){const s=t.timestamp/1e3;0===this.startTimestamp&&(this.startTimestamp=s,this.scheduleFinishTime=this.startTimestamp);const i=s+2/t.currentFramesPerSecond;this.scheduleSectionsIfNeeded(i);for(const[e,t]of Object.entries(this.voices)){const s=this.pendingNotes[e];for(;s.length>0;){const[e,r]=s[0];if(e>i)break;s.shift(),t.scheduleNote(e,r)}}}}t.ArrangementPlay=ArrangementPlay,i=ArrangementPlay,ArrangementPlay.componentId=(0,o.registerComponent)(i);t.ArrangementPlaySystem=e=>e.systemFor([n.Context,ArrangementPlay],{runEach(t,s,i){s.audio.resume(),i.continuePlaying(s,e.clock)},runEachSet(e,t,s){s.setupVoicesIfNeeded(t)}})},668:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(r,o){function n(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.makeAudioWorkletNodeFactory=t.AudioWorkletProcessor=void 0;const r=s(264);class AudioWorkletProcessor{static get parameterDescriptors(){return[]}}t.AudioWorkletProcessor=AudioWorkletProcessor,AudioWorkletProcessor.workletOptions={},t.makeAudioWorkletNodeFactory=function(e){const t=`data:text/javascript,${encodeURIComponent(e.toString())}; registerProcessor('${e.name}', ${e.name})`;let s=new WeakMap;return r.Context.setupFns.push((e=>i(this,void 0,void 0,(function*(){let i=s.get(e);i||(i=e.audio.audioWorklet.addModule(t),s.set(e,i)),yield i})))),t=>new AudioWorkletNode(t,e.name,e.workletOptions)}},264:function(e,t,s){"use strict";var i,r=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(r,o){function n(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;const o=s(956);class Context{static setup(){return r(this,void 0,void 0,(function*(){const e=new i;return yield Promise.all(i.setupFns.map((t=>t(e)))),e}))}constructor(){this.audio=new AudioContext({sampleRate:44100,latencyHint:"interactive"})}}t.Context=Context,i=Context,Context.componentId=(0,o.registerComponent)(i),Context.setupFns=[]},492:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NESNoise=t.NESNoiseProcessor=void 0;const i=s(668);class AudioWorkletProcessor extends i.AudioWorkletProcessor{}class NESNoiseProcessor extends AudioWorkletProcessor{constructor(){super(...arguments),this.travel=0,this.shiftRegister=1,this.inverseSampleRate=.00026360638479979066}static get parameterDescriptors(){return[{name:"freq",defaultValue:440,minValue:0,maxValue:2e4,automationRate:"a-rate"},{name:"gain",defaultValue:0,minValue:0,maxValue:1,automationRate:"a-rate"},{name:"timbre",defaultValue:4,minValue:0,maxValue:4,automationRate:"a-rate"}]}process(e,t,s){var i,r,o;const n=t[0][0];for(let e=0;e<n.length;e++){const t=null!==(i=s.freq[e])&&void 0!==i?i:s.freq[0],a=null!==(r=s.gain[e])&&void 0!==r?r:s.gain[0],c=null!==(o=s.timbre[e])&&void 0!==o?o:s.timbre[0],u=Math.floor(c)+1;for(this.travel+=this.inverseSampleRate*t;this.travel>1;){this.travel-=1;const e=(1&this.shiftRegister)>0!==(this.shiftRegister>>u&1)>0;this.shiftRegister=this.shiftRegister>>1|(e?0:1)<<14}const l=2*(1&this.shiftRegister)-1;n[e]=l*a}return!0}}t.NESNoiseProcessor=NESNoiseProcessor,NESNoiseProcessor.nodeOptions={numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[1]},t.NESNoise=(0,i.makeAudioWorkletNodeFactory)(NESNoiseProcessor)},844:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,r)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||i(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),r(s(184),t),r(s(668),t),r(s(264),t),r(s(92),t),r(s(972),t),r(s(492),t)},228:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OscAudioWorkletNodeFactory=t.OscAudioWorkletProcessor=void 0;const i=s(668);class AudioWorkletProcessor extends i.AudioWorkletProcessor{}class OscAudioWorkletProcessor extends AudioWorkletProcessor{constructor(){super(...arguments),this.travel=0,this.priorGain=0,this.priorTimbre=0,this.vibratoTravel=0,this.priorVibratoAmount=0}static get parameterDescriptors(){return[{name:"freq",defaultValue:440,minValue:0,maxValue:2e4,automationRate:"a-rate"},{name:"gain",defaultValue:0,minValue:0,maxValue:1,automationRate:"a-rate"},{name:"timbre",defaultValue:4,minValue:0,maxValue:4,automationRate:"a-rate"},{name:"vibrato",defaultValue:0,minValue:-120,maxValue:120,automationRate:"a-rate"},{name:"vibratoFreq",defaultValue:5,minValue:0,maxValue:200,automationRate:"a-rate"}]}process(e,t,s){var i,r,o,n,a;const c=t[0][0],u=1/44100,l=OscAudioWorkletProcessor;for(let e=0;e<c.length;e++){let t=null!==(i=s.freq[e])&&void 0!==i?i:s.freq[0],d=null!==(r=s.gain[e])&&void 0!==r?r:this.priorGain,h=null!==(o=s.timbre[e])&&void 0!==o?o:this.priorTimbre,f=null!==(n=s.vibrato[e])&&void 0!==n?n:this.priorVibratoAmount;const m=null!==(a=s.vibratoFreq[e])&&void 0!==a?a:s.vibratoFreq[0];if(0===this.priorGain&&(this.travel=1,this.vibratoTravel=1),this.vibratoTravel+=u*m,this.vibratoTravel<=1)f=this.priorVibratoAmount;else for(;this.vibratoTravel>1;)this.vibratoTravel-=1;const{vibratoTravel:p}=this,v=1;if(t*=l.semitonesToRatio(f*l.waveform(p,v)),this.travel+=u*t,this.travel<=1)d=this.priorGain,h=this.priorTimbre;else for(;this.travel>1;)this.travel-=1;const{travel:y}=this;c[e]=l.waveform(y,h)*d,this.priorGain=d,this.priorTimbre=h,this.priorVibratoAmount=f}return!0}static semitonesToRatio(e){return Math.pow(2,e/12)}static waveform(e,t){if(0===t)return Math.sin(2*e*Math.PI);if(1===t)return e<=.25?4*e:e<=.75?2-4*e:4*e-4;if(2===t)return 1-2*e;if(t<1){return(1-t)*Math.sin(2*e*Math.PI)+t*(e<=.25?4*e:e<=.75?2-4*e:4*e-4)}if(t<2){const s=-.25*t+.5,i=1/s;return e<=s?e*i:e<1-s?1-(e-s)*(2/(1-2*s)):(e-1)*i}if(t<3){return(3-t)*(1-2*e)+(t-2)*(e<=.5?1:-1)}if(t<=4){return e<=.5*Math.pow(.25,t-3)?1:-1}return 0}}t.OscAudioWorkletProcessor=OscAudioWorkletProcessor,OscAudioWorkletProcessor.nodeOptions={numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[1]},t.OscAudioWorkletNodeFactory=(0,i.makeAudioWorkletNodeFactory)(OscAudioWorkletProcessor)},92:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.riffSeqToVoiceNotes=t.riffCharCodeToGain=t.riffOctaveAt=t.riffGainAt=t.riffCharCodeToOctave=t.riffScaleNumberToFrequency=t.riffKeyToSemitoneOffset=t.riffScaleNumberToSemitoneOffset=t.riffCharCodeToScaleNumber=t.riffDuration=t.riffComputeStepSizes=void 0;const s="o".charCodeAt(0),i="0".charCodeAt(0),r="p".charCodeAt(0),o="1".charCodeAt(0),n="q".charCodeAt(0),a="2".charCodeAt(0),c="w".charCodeAt(0),u="3".charCodeAt(0),l="e".charCodeAt(0),d="4".charCodeAt(0),h="r".charCodeAt(0),f="5".charCodeAt(0),m="t".charCodeAt(0),p="6".charCodeAt(0),v="y".charCodeAt(0),y="7".charCodeAt(0),b="u".charCodeAt(0),g="8".charCodeAt(0),w="i".charCodeAt(0),k="9".charCodeAt(0),A="-".charCodeAt(0),x=" ".charCodeAt(0),S="0".charCodeAt(0),q="9".charCodeAt(0),C="@".charCodeAt(0),O=" ".charCodeAt(0),E="+".charCodeAt(0),P="-".charCodeAt(0),M=",".charCodeAt(0),T="`".charCodeAt(0),_="^".charCodeAt(0),B="-".charCodeAt(0),N=" ".charCodeAt(0),R="0".charCodeAt(0),j="9".charCodeAt(0),V="@".charCodeAt(0);function F(e){const t=[],s=e.split(""),i=s.length;s.push("|");for(let e=-1;e<i;){const i=s.indexOf("|",e+1);if(e>=0){const s=i-e;t.push(...Array(s).fill(1/s))}e=i}return t}function I(e){switch(e){case s:return-.5;case i:return 0;case r:return.5;case o:return 1;case n:return 1.5;case a:return 2;case c:return 2.5;case u:return 3;case l:return 3.5;case d:return 4;case h:return 4.5;case f:return 5;case m:return 5.5;case p:return 6;case v:return 6.5;case y:return 7;case b:return 7.5;case g:return 8;case w:return 8.5;case k:return 9}throw new Error(`Unknown riff scale code: ${e}`)}function L(e,t){let s=0;for(;e<1;)e+=7,s-=12;for(;e>=8;)e-=7,s+=12;switch(e){case 1:return s+0;case 1.5:return s+1;case 2:return s+2;case 2.5:return s+3;case 3:return s+(t.endsWith("-minor")?3:4);case 3.5:return s+4;case 4:return s+5;case 4.5:return s+6;case 5:return s+7;case 5.5:return s+8;case 6:return s+(t.endsWith("-minor")?8:9);case 6.5:return s+(t.endsWith("-minor")?9:10);case 7:return s+(t.endsWith("-minor")?10:11);case 7.5:return s+11}throw new Error(`Unknown riff scale number: ${e}`)}function U(e){switch(e.split("-")[0]){case"C":return-9;case"C#":case"Db":return-8;case"D":return-7;case"D#":case"Eb":return-6;case"E":return-5;case"F":return-4;case"F#":case"Gb":return-3;case"G":return-2;case"G#":case"Ab":return-1;case"A":return 0;case"A#":case"Bb":return 1;case"B":return 2}throw new Error(`Unknown riff key: ${e}`)}function W(e,t,s){const i=U(s)+L(e,s);return 440*Math.pow(2,t-4+i/12)}function D(e,t){if(e>=S&&e<=q)return e-S;if(e===C)return 10;if(e===O)return t;if(e===E)return t+1;if(e===P)return t-1;if(isNaN(e))return t;throw new Error(`Unknown riff octave code: ${e}`)}function K(e,t){var s;let i=1;if(!e.vol)return i;for(let r=0;r<=t;r++)i=null!==(s=z(e.vol.charCodeAt(r)))&&void 0!==s?s:i;return i}function G(e,t){let s=4;if(!e.oct)return s;for(let i=0;i<=t;i++)s=D(e.oct.charCodeAt(i),s);return s}function z(e){if(e>=R&&e<=j)return(e-R)/10;if(e===V)return 1;if(e!==N&&!isNaN(e))throw new Error(`Unknown riff volume code: ${e}`)}function $(e,t,s,i){var r;let o=0,n=s;for(;n<t.length&&i(t.charCodeAt(n),n);n++)o+=null!==(r=e[n])&&void 0!==r?r:0;return{duration:o,stepCount:n-s}}function Z(e,t,s,i,r){var o,n;if(!e.gls)return;const a=60/e.bpm,c=$(t,e.gls,s,(e=>e===r)),u=I(e.gls.charCodeAt(s+c.stepCount))*(r===M?-1:1),l=i.duration-(null!==(o=t[s])&&void 0!==o?o:0)*a,d=l+c.duration*a,h=W(i.scaleNumber+u,G(e,s),e.key)-i.freqBase;i.freqSlides=null!==(n=i.freqSlides)&&void 0!==n?n:[],i.freqSlides.push({timeStart:l,timeEnd:d,deltaStart:h,deltaEnd:0})}function X(e,t,s,i){var r,o,n,a;if(!e.gls)return;const c=60/e.bpm,u=(null!==(r=t[s])&&void 0!==r?r:0)*c,l=$(t,e.gls,s,((e,t)=>t===s||e===B)),d=l.duration*c,h=l.stepCount,f=function(e,t,s){for(let i=t;i<s;i++){const t=e.seq.charCodeAt(i);if(t!==A&&t!==x)return{scaleNumber:I(t),octave:G(e,i)}}}(e,s,s+h);if(!f)return;i.freqSlides=null!==(o=i.freqSlides)&&void 0!==o?o:[];const m=i.duration-u,p=m+d,v=null!==(a=null===(n=i.freqSlides[i.freqSlides.length-1])||void 0===n?void 0:n.deltaEnd)&&void 0!==a?a:0,y=W(f.scaleNumber,f.octave,e.key)-i.freqBase;i.freqSlides.push({timeStart:m,timeEnd:p,deltaStart:v,deltaEnd:y})}t.riffComputeStepSizes=F,t.riffDuration=function(e){var t;const s=60/e.bpm,i=F(e.div);let r=0;for(let o=0;o<e.seq.length;o++)r+=(null!==(t=i[o])&&void 0!==t?t:0)*s;return r},t.riffCharCodeToScaleNumber=I,t.riffScaleNumberToSemitoneOffset=L,t.riffKeyToSemitoneOffset=U,t.riffScaleNumberToFrequency=W,t.riffCharCodeToOctave=D,t.riffGainAt=K,t.riffOctaveAt=G,t.riffCharCodeToGain=z,t.riffSeqToVoiceNotes=function(e){var t,s,i,r,o,n;const a=60/e.bpm,c=F(e.div),u=[];let l,d=0;for(let h=0;h<e.seq.length;h++){const f=(null!==(t=c[h])&&void 0!==t?t:0)*a,m=e.seq.charCodeAt(h),p=null===(s=e.gls)||void 0===s?void 0:s.charCodeAt(h),v=null===(i=e.vol)||void 0===i?void 0:i.charCodeAt(h);if(m===A)l&&(l.duration+=f);else if(m===x);else if(!l||p!==_&&p!==B){const t=I(m),s=G(e,h);l={duration:f,freqBase:W(t,s,e.key),scaleNumber:t,octave:s},u.push([d,l]);const i=K(e,h);1!=i&&void 0===z(null!=v?v:0)&&(null!==(r=l.gainEvents)&&void 0!==r||(l.gainEvents=[]),l.gainEvents.push({time:0,gain:i}))}else l&&(l.duration+=f);if(l&&p){const t=null===(o=e.gls)||void 0===o?void 0:o.charCodeAt(h-1);p===_&&t!==_?X(e,c,h,l):p===M&&t!==M?Z(e,c,h,l,M):p===T&&t!==T&&Z(e,c,h,l,T)}if(l&&v){const e=z(v);void 0!==e&&(null!==(n=l.gainEvents)&&void 0!==n||(l.gainEvents=[]),l.gainEvents.push({time:l.duration-f,gain:e}))}d+=f}return u.forEach((([e,t])=>{delete t.scaleNumber,delete t.octave})),u}},972:(e,t,s)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Voice=void 0;const r=s(956),o=s(228);function n(e){return e.createGain().gain}class Voice{constructor(e,t){var s,i,r,a,c,u,l,d,h;this.context=e,this.config=t;const f=(null!==(s=this.config.worklet)&&void 0!==s?s:o.OscAudioWorkletNodeFactory)(e.audio),m=e.audio.createGain(),p=e.audio.createStereoPanner();f.connect(m),m.connect(p),p.connect(e.audio.destination),this.freq=null!==(i=f.parameters.get("freq"))&&void 0!==i?i:n(e.audio),this.gain=null!==(r=f.parameters.get("gain"))&&void 0!==r?r:n(e.audio),this.timbre=null!==(a=f.parameters.get("timbre"))&&void 0!==a?a:n(e.audio),this.vibrato=null!==(c=f.parameters.get("vibrato"))&&void 0!==c?c:n(e.audio),this.vibratoFreq=null!==(u=f.parameters.get("vibratoFreq"))&&void 0!==u?u:n(e.audio),this.finalGain=m.gain,this.finalPan=p.pan,this.freq.value=440,this.gain.value=0,this.timbre.value=null!==(l=this.config.timbre)&&void 0!==l?l:0,this.vibrato.value=null!==(d=this.config.vibrato)&&void 0!==d?d:0,this.vibratoFreq.value=null!==(h=this.config.vibratoFreq)&&void 0!==h?h:4,this.finalGain.value=this.config.gain,this.finalPan.value=this.config.pan}scheduleNote(e,t){const s=e,i=s+t.duration,{gain:r,freq:o}=this;o.setValueAtTime(t.freqBase,s),t.freqSlides&&t.freqSlides.forEach((e=>{o.setValueAtTime(t.freqBase+e.deltaStart,s+e.timeStart),o.exponentialRampToValueAtTime(t.freqBase+e.deltaEnd,s+e.timeEnd)})),r.cancelScheduledValues(s),r.setValueAtTime(0,s),r.linearRampToValueAtTime(1,s+0),t.gainEvents&&t.gainEvents.forEach((({time:e,gain:t})=>{r.setValueAtTime(t,s+e)})),r.cancelScheduledValues(i-.01),r.setValueAtTime(0,i-.01),r.linearRampToValueAtTime(0,i)}}t.Voice=Voice,i=Voice,Voice.componentId=(0,r.registerComponent)(i)},608:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,r)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||i(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),t.Onyx=void 0,t.Onyx=s(844),r(s(844),t)},711:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var s=e(t);return t.add(s),s}},s=function(e){return function(t,s){return e.set(t,s),s}},i=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,r=536870912,o=2*r,n=function(e,t){return function(s){var n=t.get(s),a=void 0===n?s.size:n<o?n+1:0;if(!s.has(a))return e(s,a);if(s.size<r){for(;s.has(a);)a=Math.floor(Math.random()*o);return e(s,a)}if(s.size>i)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;s.has(a);)a=Math.floor(Math.random()*i);return e(s,a)}},a=new WeakMap,c=s(a),u=n(c,a),l=t(u);e.addUniqueNumber=l,e.generateUniqueNumber=u}(t)}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";var e=s(956),t=s(608);const i=173,r="Bb-minor",o={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   ",seq:"5-555-553-5-  4-  7-7-7-7-7-5-5-",gls:",,1               ,,p   ,,p ",vol:"@ 86@ 86  8       @ 8 8 @ 8 9 6",oct:"4                 -"},n={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   ",seq:"8-531-815-3-  2- ",gls:",,1              ",vol:"2 424 646 8      ",oct:"4       5        "},a={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   ",seq:"5 1-- 551-- 5 1----- ",gls:"  ,,,8  ,,,8  ,,,,,,8",oct:"7 6   766   6 7   ",vol:"6 @   68@   4 987631"},c={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   ",seq:"1---  1---  1-2---",gls:"`9    `9    `9,1  ",vol:"@@6@  @@6@  @6@@6@",oct:"1"},u={bpm:i,key:r,div:"||||||       |   ||",seq:"         0-247---",vol:"         3 59@631",oct:"9"},l={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   ",seq:"5 5 1-5 5 5 1-5 5 5 1-5 5 5 1-5 ",gls:"    ,,8     ,,8     ,,8     ,,8 ",oct:"7   6 7 7   6 7 7   6 7 7   6 7 ",vol:"6   @ 6 6   @ 6 6   @ 6 6   @ 6 "},d={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"1-1-1-1-  1-3-5-0-0 0-0 4-4-1-1-6-6-6-6-  6-1-3-0-0-0-0-  0-4-7-",vol:"@6@6@6@6  @6@   @6@ @6@ @6@6@6@6@6@6@6@6  @6@   @6@6@6@6  @6@   ",gls:"`9    `9    `7  `9      `9  `9  `9    `9    `7  `9    `9    `6  ",oct:"1                       0       0         0 1   1         1     "},h={bpm:i,key:r,div:"| | | | | | | | | | | | | | | | ",seq:"51035451045337206313487479742904",oct:"24423234244142442442424424424244",vol:"456"},f={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"8-531-815-3-  2-  815-3-  2-  0-8-631-816-3-  2-  7-  4-  7-    ",gls:",,1                                                             ",vol:"4 626 846 8       646 8   6   2 4 624 646 8       6             ",oct:"4       5         4 5           4       5         4             "},m={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"5-------- 1-3-7-  6-  5---3-4-5------ 8------ 9------ 4------",vol:"@49382716 @4@4@4  @4  @493@4@4@493827 @493827 @493827 @493827",gls:",q"},p={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"  9---8-5---7-8-3-2---3---2-3-5-----------4-2-7-----------9-7-4-",vol:"  @49382@493@49382@493@4938271@493827161417182@4938271614193@4@4",gls:"  ,,1                                                     ,1    ",oct:"4               5                                           4   "},v={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"5-------- 1-3-7-  6-  5---3-4-5------ 8------ 9---4-7-9-7------",vol:"@49382716 @4@4@4  @4  @493@4@4@493827 @493827 @493827   @493827",gls:",q                                                      ,q",oct:"4                                                       5"},y={bpm:i,key:r,div:"|       |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"    7-7-3-7-5------                                           3-3-3-",vol:"    @4@48   @493827                                           7193@4",gls:"    ,p      ,,1                                               ,1    ",oct:"4           5                                                       "},b={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   ",seq:"1-5---1-5---1-5---5 5 5 5 5 5 5 ",gls:",,5   ,,5   ,,5                 ",oct:"6     6     6     7   7   7   7 ",vol:"@86421@86421@864214 5 6 7 8 9 @ "},g={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"6---6-6-  5-6---  1-6-5-  4-  3-1---1-1-  0-1---",vol:"@686@6@6  @6@     @6@ @6  @6    @686@6@6  @6@   ",gls:"`9    `9    `9      `3    `1    `9    `9    `9",oct:"0                 1             1"},w={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"4---4-4-  3-4---  1-7-4-  3-  8-7---7-7-  6-7---",vol:"@ 8 @6@6  @6@     @6@ @6  @6    @ 8 @6@6  @6@   ",gls:"`9    `9    `9      `2    `2    `9    `9    `9",oct:"0                 1             0"},k={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"4---4-4-  3-4---  6-------5-4-3-5---5-5-  4-5---",vol:"@ 8 @6@6  @6@     @8      @8@8@8@ 8 @6@6  @6@   ",gls:"`9    `9    `9    `3  `3  `4    `9    `9    `9",oct:"0                 1             0"},A={bpm:i,key:r,div:"| | | | | | | | | | | | | | | | ",seq:"61313638034373715013038597355193",oct:"24424424254144242442442424424424",vol:"6"},x={bpm:i,key:r,div:"| | | | | | | | | | | | | | | | ",seq:"61414863442664714012028497244092",oct:"24424425255144242442442424424424",vol:"6"},S={bpm:i,key:r,div:"| | | | | | | | | | | | | | | | ",seq:"61414863442664715p1p254u295u425p",oct:"24424425255144242442443434424424",vol:"6"},q={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"3---3---3-5---4---2---    1-4-5-------    1-4-7-----  9-------- ",gls:",,1       `p      `p      ,,1             ,,1                   ",vol:"@ 93@ 93@4@ 93@ 93@ 93    @ @4@ 93        @ @4@ 93    @ 93      ",oct:"5"},C={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"      3-- 2-- 3-- 4-5-0-----      1-4-5-----  7---6---5---4---3-",gls:"                  ,,2                         ,,2               ",vol:"      31  31  31  3   3 21        5   5 41    5 415 415 415 41  "},O={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"  3---2-5---          6---5-3-7-------                    3-3-3-",vol:"  @ 93@4@ 93          @ 93@4@4@ 92                        7193@4",gls:"  ,,q                 ,,q                                 ,1    ",oct:"  6     5                                                       "},E={bpm:i,key:r,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"          3---2-5-------          3-4-6---5-3-1-5-----4-------- ",gls:"          ,,q                                                   ",vol:"          5 41545 41              3 4 5 415 4 3 5 41  5 41      ",oct:"          5     4"},P={voices:{leadL:{timbre:2.75,gain:.08,pan:-.7},leadR:{timbre:2.75,gain:.08,pan:.7},leadC:{timbre:3,gain:.1,pan:0},bass:{timbre:1.1,gain:.5,pan:0},drums:{timbre:0,gain:.08,pan:0,worklet:t.Onyx.NESNoise},noise:{timbre:5,gain:.1,pan:0,worklet:t.Onyx.NESNoise}},sections:{intro:{leadL:[o],leadR:[n],bass:[c],drums:[a],noise:[u]},main1:{leadC:[m],leadL:[h],leadR:[f],bass:[d],drums:[l,l]},main2:{leadC:[p],leadL:[h],leadR:[f],bass:[d],drums:[l,l]},main3:{leadC:[v],leadL:[h],leadR:[f],bass:[d],drums:[l,l]},main4:{leadC:[y],leadL:[h],leadR:[f],bass:[d],drums:[l,l]},mid1:{leadC:[q],leadL:[A],leadR:[C],bass:[g],drums:[b,b]},mid2:{leadC:[O],leadL:[x],leadR:[E],bass:[w],drums:[b,b]},mid4:{leadL:[S],bass:[k],drums:[b,b]}},pre:["intro"],loop:["main1","main2","main3","main4","mid1","mid2","mid1","mid4"]},M=Object.assign(Object.assign({},P),{sections:Object.fromEntries(Object.entries(P.sections).map((([e,t])=>[e,Object.fromEntries(Object.entries(t).map((([e,t])=>[e,t.map((e=>Object.assign(Object.assign({},e),{key:"B-major"})))])))])))}),T=181,_="C-minor",B={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   ",seq:"5 5 1-5 5 5 1-5 5 5 1-5 5 5 1-5 ",gls:"    ,,8     ,,8     ,,8     ,,8 ",oct:"7   6 7 7   6 7 7   6 7 7   6 7 ",vol:"6   @ 6 6   @ 6 6   @ 6 6   @ 6 "},N={bpm:T,key:_,div:"| | | | | | | | ",seq:"3533513553335335",oct:"2442444244244244"},R={bpm:T,key:_,div:"| | | | | | | | ",seq:"2422402542224224",oct:"2442444244244244"},j={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   ",seq:" 3-5-3-3-5-1-3-5-5-3-3-3-5-3-3-5",oct:" 2 4 4 2 4 4 4 2 4 4 2 4 4 2 4 4",vol:"8"},V={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   ",seq:" 2-4-2-2-4-0-2-5-4-2-2-2-4-2-2-4",oct:" 2 4 4 2 4 4 4 2 4 4 2 4 4 2 4 4",vol:"8"},F={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   ",seq:"1---3-1-  0-3-1-1---3-1-  0-3-1-",gls:"    ``5     ``5     ``5     ``5 "},I={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   ",seq:"2---3-2-  1-3-2-2---3-2-  1-3-2-",gls:"    ``5     ``5     ``5     ``5 "},L={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   ",seq:"2---3-2-  1-3-2-p---3-2-  p-3-2-",gls:"    ``5     ``5     ``5     ``5 "},U={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"3-----  3-4-  5-  4-  3-  3-4-- 2-3-2 2-  1-- 0-----  7---- 6---",oct:"5"},W={bpm:T,key:_,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"5-----  5-4-3-7-  6-  5-  5-8-u-------    5-u-9-------          ",oct:"5"},D={voices:{leadL:{timbre:3,gain:.06,pan:-.33},leadR:{timbre:3,gain:.06,pan:.33},leadC:{timbre:3,gain:.1,pan:0,vibrato:-.5,vibratoFreq:8},bass:{timbre:1,gain:.5,pan:0},noise:{timbre:0,gain:.08,pan:0,worklet:t.Onyx.NESNoise}},sections:{walk:{leadL:[F,I,F,L],leadR:[j,V,j,V],bass:[N,R,N,R],noise:[B,B,B,B]},walkWithMelody:{leadC:[U,W],leadL:[F,I,F,L],leadR:[j,V,j,V],bass:[N,R,N,R],noise:[B,B,B,B]}},loop:["walk","walkWithMelody"]},K=241,G="D-minor",z={bpm:K,key:G,div:"| | | | | | | | | | | | | | | | ",seq:"0135----5431----4310----1-------",gls:",p      `p       ",vol:"@89@ 2  @89@ 2  @89@ 2  @ 282622",oct:"5"},$={bpm:K,key:G,div:"| | | | | | | | | | | | | | | | ",seq:"0135----5431----4310----7-------",gls:",p      `p              ,,q",vol:"@89@ 2  @89@ 2  @89@ 2  @ 282622",oct:"5"},Z={bpm:K,key:G,div:"| | | | | | | | | | | | | | | | ",seq:"7540----4435----3479 8-7--------",gls:",p      ,p              ",vol:"@89@ 2  @89@ 2  @89@   @ 282622",oct:"5"},X={bpm:K,key:G,div:"|   |   |   |   |   |   |   |   ",seq:"1-- 0-1-3-- 1-3-5-7-5-  4-  3-  ",gls:",,1             ,,1",vol:"",oct:"4"},H={bpm:K,key:G,div:"|   |   |   |   |   |   |   |   ",seq:"5-- 4-5-8-- 5-1-3-5-3-  2-  1-  ",gls:",,1             ,,1",vol:"",oct:"4             5"},Y={bpm:K,key:G,div:"|   |   |   |   |   |   |   |   ",seq:"1---  1---  1-----------        ",gls:"`9    `9    ````````````8       ",vol:"@@6@  @@6@  @6@@6@              ",oct:"2"},J={bpm:K,key:G,div:"|   |   |   |   |   |   |   |   ",seq:"5 2 2 5 2 2 1---5 2 2 5 2 1-1---",gls:"            ,,8           ,8,,8 ",oct:"7     7     6   7     7   6 6   ",vol:"6 3 3 6 3 3 @7536 3 3 6 3 @7@753"},Q={voices:{leadL:{timbre:3.75,gain:.05,pan:-.33},leadR:{timbre:3.75,gain:.05,pan:.33},leadC:{timbre:2.5,gain:.1,pan:0,vibrato:-.5,vibratoFreq:6},bass:{timbre:1,gain:.5,pan:0},noise:{timbre:0,gain:.08,pan:0,worklet:t.Onyx.NESNoise}},sections:{main1:{leadL:[X,X],leadR:[H,H],leadC:[z],bass:[Y,Y],noise:[J,J]},main3:{leadL:[X,X],leadR:[H,H],leadC:[$],bass:[Y,Y],noise:[J,J]},main4:{leadC:[Z],bass:[Y,Y],noise:[J,J]}},loop:["main1","main1","main3","main4"]};var ee=s(711);const te=((e,t)=>{let s=null;return()=>{if(null!==s)return s;const i=new Blob([t],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(i);return s=e(r),setTimeout((()=>URL.revokeObjectURL(r))),s}})((e=>{const t=new Map([[0,()=>{}]]),s=new Map([[0,()=>{}]]),i=new Map,r=new Worker(e);r.addEventListener("message",(({data:e})=>{if(void 0!==(r=e).method&&"call"===r.method){const{params:{timerId:r,timerType:o}}=e;if("interval"===o){const e=t.get(r);if("number"==typeof e){const t=i.get(e);if(void 0===t||t.timerId!==r||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e()}}else if("timeout"===o){const e=s.get(r);if("number"==typeof e){const t=i.get(e);if(void 0===t||t.timerId!==r||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e(),s.delete(r)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(e)){const{error:{message:t}}=e;throw new Error(t)}{const{id:r}=e,o=i.get(r);if(void 0===o)throw new Error("The timer is in an undefined state.");const{timerId:n,timerType:a}=o;i.delete(r),"interval"===a?t.delete(n):s.delete(n)}}var r}));return{clearInterval:e=>{const s=(0,ee.generateUniqueNumber)(i);i.set(s,{timerId:e,timerType:"interval"}),t.set(e,s),r.postMessage({id:s,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=(0,ee.generateUniqueNumber)(i);i.set(t,{timerId:e,timerType:"timeout"}),s.set(e,t),r.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,s=0)=>{const i=(0,ee.generateUniqueNumber)(t);return t.set(i,(()=>{e(),"function"==typeof t.get(i)&&r.postMessage({id:null,method:"set",params:{delay:s,now:performance.now(),timerId:i,timerType:"interval"}})})),r.postMessage({id:null,method:"set",params:{delay:s,now:performance.now(),timerId:i,timerType:"interval"}}),i},setTimeout:(e,t=0)=>{const i=(0,ee.generateUniqueNumber)(s);return s.set(i,e),r.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:i,timerType:"timeout"}}),i}}}),'(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'),se=150,ie="G-minor",re={bpm:se,key:ie,div:"||",seq:"5-",oct:"3"},oe={bpm:se,key:ie,div:"||",seq:"4-",oct:"3"},ne={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"1---------1-2-3-2---5-------2---321-------------------------5---",oct:"4                                                           3   "},ae={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"3---1---5-3-2-1-5---2---u---4---543-1---3---5---2---4---5---4---",oct:"3"},ce={bpm:se,key:ie,div:"||||||||||||||||",seq:"1-3-0-5-1-5-0-5-",oct:"2 2 2 - 2 2 2 - "},ue={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"1---------1-2-3-4-------2---0---545-------------------------5---",oct:"4                                                           3   "},le={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"3---1---5-3-2-1-2---0---4---5---7---5---3---5---u---4---2---4---",oct:"3"},de={bpm:se,key:ie,div:"||||||||||||||||",seq:"1-3-0---3-5-2-5-",oct:"2 2 2   2 2 2 - "},he={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"1---------1-2-3-2---5-------2---34321-----------------------5---",oct:"4                                                           3   "},fe={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"3---1---5-3-2-1-5---2---u---4---5---3---1---3---2---4---5---4---",oct:"3"},me={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"1---------1-2-3-2-------0---2---321-------------------------5---",oct:"4"},pe={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"3---1---5-3-2-1-6---4---2---0---543-------------853---------3---",oct:"3                                                           4   "},ve={bpm:se,key:ie,div:"||||||||||||||||",seq:"1-3-0-2-1-5-1-5-",oct:"2 2 2 2 2 - 2 - "},ye={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"8-------7---6---78765-------5---6-------4---7---5-----------5---",oct:"4"},be={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"4---2-------4---56543-------7---4-----4-2---2---32343-------3---",oct:"4"},ge={bpm:se,key:ie,div:"||||||||||||||||",seq:"6-47303-20-43037",oct:"1   2 2 2 - 2 - "},we={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"8-------7---6---54345-------5---r-------2---y---uy5---------5---",oct:"4                                                           3   "},ke={bpm:se,key:ie,div:"|   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   ",seq:"4-------3---2---76567-------3---y-----y-r---y---4---2---p---4---",oct:"4               3           4   3               4           3   "},Ae={bpm:se,key:ie,div:"||||||||||||||||",seq:"64043-0-2-y-5-  ",oct:"2   2 2 2 -     "},xe={voices:{leadL:{timbre:3.5,gain:.06,pan:-.33},leadR:{timbre:3.5,gain:.06,pan:.33},bass:{timbre:1,gain:.6,pan:0},noise:{timbre:0,gain:.08,pan:0,worklet:t.Onyx.NESNoise}},sections:{pre:{leadL:[re],leadR:[oe]},main1:{leadL:[ne],leadR:[ae],bass:[ce]},main2:{leadL:[ue],leadR:[le],bass:[de]},main3:{leadL:[he],leadR:[fe],bass:[ce]},main4:{leadL:[me],leadR:[pe],bass:[ve]},mid1:{leadL:[ye],leadR:[be],bass:[ge]},mid2:{leadL:[we],leadR:[ke],bass:[Ae]}},pre:["pre"],loop:["main1","main2","main3","main4","mid1","mid2"]},Se=Object.assign(Object.assign({},xe),{sections:Object.fromEntries(Object.entries(xe.sections).map((([e,t])=>[e,Object.fromEntries(Object.entries(t).map((([e,t])=>[e,t.map((e=>Object.assign(Object.assign({},e),{key:"Ab-major"})))])))])))}),qe=new e.World;qe.addSystems([t.Onyx.ArrangementPlaySystem(qe)]),((...e)=>{te().setInterval(...e)})((()=>{qe.clock.tick(performance.now())}),500);const Ce=qe.create(),Oe=e=>{const s=new t.Onyx.ArrangementPlay(e);s.setupVoicesIfNeeded(Ee),qe.set(Ce,[Ee,s])};let Ee;t.Onyx.Context.setup().then((e=>{Ee=e;const s=()=>{switch(console.log(window.location.hash),window.location.hash){case"#silence":qe.remove(Ce,[t.Onyx.ArrangementPlay]);break;case"#blossoming-blade":Oe(P);break;case"#blossoming-blade-major":Oe(M);break;case"#bubble-man":Oe(D);break;case"#stage-select-screen":Oe(Q);break;case"#eight-eyes":Oe(xe);break;case"#eight-eyes-major":Oe(Se)}};window.addEventListener("hashchange",s),s()}))})()})();